# Continue: Migrate website from denverbytes.com to bittikens.com

## Context

This project was copied from the denverbytes.com website repo to a new GitHub repo (`stephenabbot/website_bittikens_com`). The goal is to host it on bittikens.com as a staging/development site. AWS infrastructure (S3, CloudFront, Route53, SSM params, OIDC role) already exists for bittikens.com.

## Changes Completed

All file edits are done. No code changes remain.

### Step 1: Centralized site config - DONE
- Created `src/config.ts` with `SITE_CONFIG` constants (domain, siteUrl, repoName, repoUrl)

### Step 2: Build/config files - DONE
- `config.env`: `DOMAIN_NAME=bittikens.com`, `GOOGLE_SEARCH_CONSOLE_TXT=` (empty)
- `astro.config.mjs`: `site: 'https://bittikens.com'`
- `package.json`: `"name": "website_bittikens_com"`
- NOTE: `npm install` was NOT run separately — deploy.sh handles this automatically

### Step 3: GitHub Actions workflows - DONE
- `.github/workflows/deploy.yml`: role changed to `gharole-website_bittikens_com-prd`
- `.github/workflows/destroy.yml`: same role change

### Step 4: Astro components - DONE
- `src/components/MainHead.astro`: Person schema URL now uses `Astro.site?.href ?? "https://bittikens.com"`
- `src/components/Nav.astro`: Fixed "LinkeIn" typo → "LinkedIn"

### Step 5: Dynamic robots.txt - DONE
- Deleted `public/robots.txt`
- Created `src/pages/robots.txt.ts` as Astro API endpoint (reads site URL from Astro config)

### Step 6: Content/doc references - DONE
- `src/pages/architecture.astro`: GitHub link → `website_bittikens_com`
- `src/content/resume/resume.md`: website → `https://bittikens.com`
- `src/content/work/website-infrastructure.md`: Reordered domains (bittikens.com as "This website", denverbytes.com as "Production website")
- `src/content/work/professional-website-platform.md`: Repo link and live site → bittikens.com
- `README.md`: Repo reference → `website_bittikens_com`
- `docs/operations.md`: All denverbytes references → bittikens (~11 replacements)
- `docs/troubleshooting.md`: All denverbytes references → bittikens (~4 replacements)

### Step 7: CloudFront basic auth scripts - DONE
- Created `scripts/cloudfront-basic-auth.js` (CloudFront Function source, credentials: stabbot/changeme)
- Created `scripts/manage-cloudfront-auth.sh` (enable/disable/status subcommands, chmod +x applied)

### Step 8: Verification grep - DONE
- Remaining "denverbytes" references are expected:
  - `website-infrastructure.md` — intentionally lists denverbytes.com as "Production website"
  - `TODO/` files — not deployed
  - `package-lock.json` — regenerated by npm install during deploy
  - `.astro/data-store.json` — build cache, regenerated during build

## Current Blocker: Deploy

Deploy failed because the `AWS_ACCOUNT_ID` GitHub variable is not set on the `stephenabbot/website_bittikens_com` repo.

### What needs to happen

1. **Set the GitHub variable** (one command):
   ```bash
   gh variable set AWS_ACCOUNT_ID --body "694394480102" --repo stephenabbot/website_bittikens_com
   ```
   This is the same account ID used by the denverbytes repo (confirmed via `gh variable list --repo stephenabbot/website_denverbytes_com`).

2. **Run deploy**:
   ```bash
   ./scripts/deploy.sh
   ```
   This handles npm install, build, S3 upload, CloudFront invalidation, and verification.

3. **Enable basic auth** (after deploy succeeds):
   ```bash
   ./scripts/manage-cloudfront-auth.sh enable
   ```

4. **Wait ~3 minutes** for CloudFront propagation.

5. **Test site access**:
   ```bash
   # Should return 401 without auth
   curl -I https://bittikens.com

   # Should return 200 with auth
   curl -I -u stabbot:changeme https://bittikens.com

   # Verify robots.txt shows bittikens.com
   curl -u stabbot:changeme https://bittikens.com/robots.txt
   ```

## Notes

- The deploy script (`scripts/deploy.sh`) is fully dynamic — reads DOMAIN_NAME from config.env and project name from git remote. No changes needed to it.
- npm is the package manager (installed via fnm, Node v22). Deploy handles `npm install` automatically if node_modules is missing.
- The `GOOGLE_SEARCH_CONSOLE_TXT` is intentionally empty — bittikens.com is a dev/staging site and doesn't need Search Console verification. The deploy script's DNS verify step will warn but won't fail.
- GitHub CLI is authenticated as `stabbotco1` (has repo + workflow scopes).
- No git commit has been made yet — all changes are uncommitted.
