---
import { getCollection } from "astro:content";
import ContactCTA from "../components/ContactCTA.astro";
import Grid from "../components/Grid.astro";
import Hero from "../components/Hero.astro";
import PortfolioPreview from "../components/PortfolioPreview.astro";
import BaseLayout from "../layouts/BaseLayout.astro";

const allProjects = (await getCollection("work")).sort(
	(a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
);

// Group projects by logical dependencies and usage order
const foundationProjects = allProjects.filter(project => 
	project.data.title.includes("Foundation") || 
	project.data.title.includes("Bootstrap")
);

const infrastructureProjects = allProjects.filter(project => 
	project.data.title.includes("Website Infrastructure") ||
	project.data.title.includes("Professional Website Platform") ||
	project.data.title.includes("Service Observability") ||
	project.data.title.includes("Service Ephemeral")
);

const communityProjects = allProjects.filter(project => 
	project.data.title.includes("mypylogger")
);
---

<BaseLayout
	title="AWS Infrastructure Projects | Stephen Abbot Portfolio"
	description="Enterprise AWS infrastructure projects including Terraform automation, IAM deployment roles, CloudTrail observability, and multi-domain website hosting. Real-world SRE solutions for regulated industries."
>
	<div class="stack gap-20">
		<main class="wrapper stack gap-12">
			<Hero
				title="My Work"
				tagline="A comprehensive portfolio of AWS infrastructure projects that demonstrate enterprise-grade SRE expertise, from foundational components to specialized services."
				align="start"
			/>
			
			<!-- Foundation Projects -->
			<section class="project-group">
				<header class="group-header">
					<h2>Foundation Infrastructure</h2>
					<p>Core infrastructure components that establish the foundation for all subsequent projects. These solve fundamental problems like backend state management, secure authentication, and deployment automation.</p>
				</header>
				<Grid variant="offset">
					{foundationProjects.map((project) => (
						<li>
							<PortfolioPreview project={project} />
						</li>
					))}
				</Grid>
			</section>

			<!-- Infrastructure Services -->
			<section class="project-group">
				<header class="group-header">
					<h2>Infrastructure Services</h2>
					<p>Specialized infrastructure services that build upon the foundation to provide scalable hosting, comprehensive observability, and cost-optimized analytics capabilities.</p>
				</header>
				<Grid variant="offset">
					{infrastructureProjects.map((project) => (
						<li>
							<PortfolioPreview project={project} />
						</li>
					))}
				</Grid>
			</section>

			<!-- Community Contributions -->
			<section class="project-group">
				<header class="group-header">
					<h2>Open Source Contributions</h2>
					<p>Community-focused projects that demonstrate software engineering excellence and commitment to knowledge sharing through reusable tools and libraries.</p>
				</header>
				<Grid variant="offset">
					{communityProjects.map((project) => (
						<li>
							<PortfolioPreview project={project} />
						</li>
					))}
				</Grid>
			</section>
		</main>
		<ContactCTA />
	</div>
</BaseLayout>

<style>
	.project-group {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	.group-header {
		text-align: center;
		max-width: 60ch;
		margin: 0 auto;
	}

	.group-header h2 {
		font-size: var(--text-2xl);
		color: var(--gray-0);
		margin-bottom: 0.5rem;
	}

	.group-header p {
		font-size: var(--text-lg);
		color: var(--gray-300);
		line-height: 1.6;
	}

	@media (min-width: 50em) {
		.group-header h2 {
			font-size: var(--text-3xl);
		}
	}
</style>
